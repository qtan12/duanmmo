<section class="container mx-auto px-3 sm:px-4 lg:px-8 py-6 lg:py-8" x-data="{
    products: [
        { id: 1, name: 'Netflix Premium 1 Tháng - Full HD - 4 Màn Hình', category: 'Tài khoản Premium', price: 199000, originalPrice: 299000, quantity: 1, image: 'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=200&h=200&fit=crop&crop=center' },
        { id: 2, name: 'Spotify Premium 3 Tháng - Tài Khoản Riêng', category: 'Dịch vụ Streaming', price: 349000, originalPrice: 499000, quantity: 2, image: 'https://images.unsplash.com/photo-1614680376573-df3480f0c6ff?w=200&h=200&fit=crop&crop=center' },
        { id: 3, name: 'NordVPN Premium 1 Năm - Bảo Mật Tối Đa', category: 'VPN & Bảo mật', price: 500000, originalPrice: 750000, quantity: 1, image: 'https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?w=200&h=200&fit=crop&crop=center' }
    ],
    get totalItems() {
        return this.products.reduce((sum, p) => sum + p.quantity, 0);
    },
    get subtotal() {
        return this.products.reduce((sum, p) => sum + (p.price * p.quantity), 0);
    },
    get discount() {
        return this.products.reduce((sum, p) => sum + ((p.originalPrice - p.price) * p.quantity), 0);
    },
    get total() {
        return this.subtotal;
    },
    formatPrice(price) {
        return price.toLocaleString('vi-VN') + 'đ';
    },
    showNotification(message, type = 'success') {
        if (window.fastNotice) {
            window.fastNotice.show(message, type);
        }
    },
    increaseQty(id) {
        const product = this.products.find(p => p.id === id);
        if (product && product.quantity < 10) {
            product.quantity++;
            this.showNotification(`Đã tăng số lượng ${product.name}`, 'success');
        } else if (product && product.quantity >= 10) {
            this.showNotification('Số lượng tối đa là 10', 'warning');
        }
    },
    decreaseQty(id) {
        const product = this.products.find(p => p.id === id);
        if (product && product.quantity > 1) {
            product.quantity--;
            this.showNotification(`Đã giảm số lượng ${product.name}`, 'success');
        } else if (product && product.quantity <= 1) {
            this.showNotification('Số lượng tối thiểu là 1', 'warning');
        }
    },
    removeProduct(id) {
        const product = this.products.find(p => p.id === id);
        if (product) {
            this.products = this.products.filter(p => p.id !== id);
            this.showNotification(`Đã xóa ${product.name} khỏi giỏ hàng`, 'success');
            
            // Trigger Lucide icons update for empty state
            if (this.products.length === 0) {
                this.$nextTick(() => {
                    if (window.lucide) {
                        window.lucide.createIcons();
                    }
                });
            }
        }
    },
    clearCart() {
        if (this.products.length > 0) {
            this.products = [];
            this.showNotification('Đã xóa tất cả sản phẩm khỏi giỏ hàng', 'info');
            
            // Trigger Lucide icons update for empty state
            this.$nextTick(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });
        } else {
            this.showNotification('Giỏ hàng đã trống', 'warning');
        }
    }
}">
    <!-- Breadcrumb -->
    <nav class="flex items-center space-x-1 sm:space-x-2 text-responsive-sm text-gray-500 mb-4  overflow-x-auto pb-2">
        <a class="text-primary hover:opacity-80 whitespace-nowrap " href="/">Trang chủ</a>
        <i data-lucide="chevron-right" class="size-4 flex-shrink-0"></i>
        <span>Giỏ hàng</span>
    </nav>

    <!-- Cart Header -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 lg:mb-8 gap-4">
        <div class="flex-1 min-w-0">
            <h1 class="text-responsive-lg font-bold text-gray-900 mb-2 sm:mb-0">Giỏ hàng của bạn</h1>
            <div class="text-responsive-sm text-gray-500 flex items-center gap-2">
                <span> Sản phẩm</span> <span x-text="totalItems"></span>
                <span>• Tổng cộng:</span> <span x-text="formatPrice(total)"></span>
            </div>
        </div>
        <div class="flex-shrink-0 flex gap-2">
            <a class="btn btn-outline btn-sm sm:btn-md w-full sm:w-auto" href="/products">
                <i data-lucide="arrow-left" class="size-4 mr-2"></i>
                <span class="text-responsive-sm"> Tiếp tục mua sắm</span>
            </a>
            <button @click="clearCart()" x-show="products.length > 0" class="btn btn-delete btn-sm sm:btn-md">
                <i data-lucide="trash-2" class="size-4 mr-2"></i>
                <span class="text-responsive-sm"> Xóa tất cả</span>
            </button>
        </div>
    </div>
    <!-- Cart Content -->
    <div class="grid lg:grid-cols-5 gap-4 lg:gap-8">
        <div class="lg:col-span-3 space-y-4 lg:space-y-6">
            <!-- Cart Items -->
            <div class="space-y-3 lg:space-y-4 my-6">
                <!-- Product 1: Netflix Premium -->
                <div class="relative card p-4 lg:p-6" x-show="products.find(p => p.id === 1)"
                    x-data="{ product: products.find(p => p.id === 1) }">
                    <div class="flex justify-between pb-1">
                        <a href="/detail.html">
                            <h3 class="item-title" x-text="product?.name">
                                Netflix Premium 1 Tháng - Full HD - 4 Màn Hình
                            </h3>
                        </a>
                    </div>

                    <!-- Delete button -->
                    <button @click="removeProduct(1)" class="i-delete">
                        <i data-lucide="x" class="size-4"></i>
                    </button>

                    <div class="flex gap-3 lg:gap-4">
                        <a class="flex-shrink-0 relative" href="/detail.html">
                            <div class="rounded-lg overflow-hidden">
                                <img :src="product?.image" :alt="product?.name"
                                    class="size-16 object-contain hover:scale-105 transition-transform duration-300">
                            </div>
                        </a>
                        <div class="flex-1 min-w-0">
                            <p class="item-category" x-text="product?.category">Tài khoản Premium</p>

                            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-0">
                                <div class="flex items-center gap-2 flex-wrap">
                                    <span class="text-responsive-sm text-green-600 mt-2"
                                        x-text="formatPrice(product?.price)">199.000đ</span>
                                    <span class="text-responsive-xs text-gray-500 line-through"
                                        x-text="formatPrice(product?.originalPrice)">299.000đ</span>
                                </div>
                                <!-- Số lượng -->
                                <div class="flex items-center gap-2 lg:gap-3 justify-between">
                                    <div class="flex items-center border border-gray-300 rounded-lg">
                                        <button @click="decreaseQty(1)" :disabled="product?.quantity <= 1"
                                            class="size-6 flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="minus" class="size-4"></i>
                                        </button>
                                        <span class="w-10 lg:w-12 text-center text-responsive-xs font-semibold"
                                            x-text="product?.quantity">1</span>
                                        <button @click="increaseQty(1)" :disabled="product?.quantity >= 10"
                                            class="size-6 flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="plus" class="size-4"></i>
                                        </button>
                                    </div>
                                    <div class="text-right">
                                        <div class="item-price"
                                            x-text="formatPrice(product?.price * product?.quantity)">199.000đ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product 2: Spotify Premium -->
                <div class="relative card p-4 lg:p-6" x-show="products.find(p => p.id === 2)"
                    x-data="{ product: products.find(p => p.id === 2) }">
                    <div class="flex justify-between pb-1">
                        <a href="/detail.html">
                            <h3 class="item-title" x-text="product?.name">
                                Spotify Premium 3 Tháng - Tài Khoản Riêng
                            </h3>
                        </a>
                    </div>

                    <!-- Delete button -->
                    <button @click="removeProduct(2)" class="i-delete">
                        <i data-lucide="x" class="size-4"></i>
                    </button>

                    <div class="flex gap-3 lg:gap-4">
                        <a class="flex-shrink-0 relative" href="/detail.html">
                            <div class="bg-gray-100 rounded-lg lg:rounded-xl overflow-hidden">
                                <img :src="product?.image" :alt="product?.name"
                                    class="size-16 object-contain hover:scale-105 transition-transform duration-300">
                            </div>
                        </a>
                        <div class="flex-1 min-w-0">
                            <p class="item-category" x-text="product?.category">Dịch vụ Streaming</p>

                            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-0">
                                <div class="flex items-center gap-2 flex-wrap">
                                    <span class="text-responsive-sm text-green-600 mt-2"
                                        x-text="formatPrice(product?.price)">349.000đ</span>
                                    <span class="text-responsive-xs text-gray-500 line-through"
                                        x-text="formatPrice(product?.originalPrice)">499.000đ</span>
                                </div>
                                <div class="flex items-center gap-2 lg:gap-3 justify-between">
                                    <div class="flex items-center border border-gray-300 rounded-lg">
                                        <button @click="decreaseQty(2)" :disabled="product?.quantity <= 1"
                                            class="w-7 h-7 lg:w-8 lg:h-8 flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="minus" class="w-3 h-3"></i>
                                        </button>
                                        <span class="w-10 lg:w-12 text-center text-xs sm:text-sm font-semibold"
                                            x-text="product?.quantity">2</span>
                                        <button @click="increaseQty(2)" :disabled="product?.quantity >= 10"
                                            class="w-7 h-7 lg:w-8 lg:h-8 flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="plus" class="w-3 h-3"></i>
                                        </button>
                                    </div>
                                    <div class="text-right">
                                        <div class="item-price"
                                            x-text="formatPrice(product?.price * product?.quantity)">698.000đ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product 3: VPN Premium -->
                <div class="relative card p-4 lg:p-6" x-show="products.find(p => p.id === 3)"
                    x-data="{ product: products.find(p => p.id === 3) }">
                    <div class="flex justify-between pb-1">
                        <a href="/detail.html">
                            <h3 class="item-title" x-text="product?.name">
                                NordVPN Premium 1 Năm - Bảo Mật Tối Đa
                            </h3>
                        </a>
                    </div>

                    <!-- Delete button -->
                    <button @click="removeProduct(3)" class="i-delete">
                        <i data-lucide="x" class="size-4"></i>
                    </button>

                    <div class="flex gap-3 lg:gap-4">
                        <a class="flex-shrink-0 relative" href="/detail.html">
                            <div class="bg-gray-100 rounded-lg lg:rounded-xl overflow-hidden">
                                <img :src="product?.image" :alt="product?.name"
                                    class="size-16 object-contain hover:scale-105 transition-transform duration-300">
                            </div>
                        </a>
                        <div class="flex-1 min-w-0">
                            <p class="item-category" x-text="product?.category">VPN & Bảo mật</p>

                            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-0">
                                <div class="flex items-center gap-2 flex-wrap">
                                    <span class="text-responsive-sm text-green-600 mt-2"
                                        x-text="formatPrice(product?.price)">500.000đ</span>
                                    <span class="text-responsive-xs text-gray-500 line-through"
                                        x-text="formatPrice(product?.originalPrice)">750.000đ</span>
                                </div>
                                <div class="flex items-center gap-2 lg:gap-3 justify-between">
                                    <div class="flex items-center border border-gray-300 rounded-lg">
                                        <button @click="decreaseQty(3)" :disabled="product?.quantity <= 1"
                                            class="w-7 h-7 lg:w-8 lg:h-8 flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="minus" class="w-3 h-3"></i>
                                        </button>
                                        <span class="w-10 lg:w-12 text-center text-xs sm:text-sm font-semibold"
                                            x-text="product?.quantity">1</span>
                                        <button @click="increaseQty(3)" :disabled="product?.quantity >= 10"
                                            class="w-7 h-7 lg:w-8 lg:h-8 flex items-center justify-center hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="plus" class="w-3 h-3"></i>
                                        </button>
                                    </div>
                                    <div class="text-right">
                                        <div class="item-price"
                                            x-text="formatPrice(product?.price * product?.quantity)">500.000đ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty Cart State -->
                <div x-show="products.length === 0" class="text-center py-12">
                    <i data-lucide="shopping-cart" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                    <p class="text-gray-500 text-responsive-lg font-semibold">Giỏ hàng trống</p>
                    <p class="text-gray-400 text-responsive-sm mt-2">Thêm sản phẩm để bắt đầu mua sắm</p>
                    <a href="/" class="btn btn-primary mt-4">Tiếp tục mua sắm</a>
                </div>
            </div>
        </div>
        <!-- Order Summary -->
        <div class="lg:col-span-2 space-y-4 lg:space-y-6">
            <div class="card p-6 lg:sticky lg:top-8">
                <h2 class="card-title mb-4">Tóm tắt đơn hàng</h2>
                <div class="space-y-3 lg:space-y-4 mb-4 lg:mb-6">
                    <div class="flex justify-between text-responsive-sm">
                        <span class="text-gray-500">Sản phẩm đã chọn:</span>
                        <span x-text="totalItems">4</span>
                    </div>
                    <div class="flex justify-between text-responsive-sm">
                        <span class="text-gray-500">Tạm tính:</span>
                        <span x-text="formatPrice(subtotal)">1.397.000đ</span>
                    </div>
                    <div class="flex justify-between text-responsive-sm">
                        <span class="text-gray-500">Phí vận chuyển:</span>
                        <span class="text-green-600">Miễn phí</span>
                    </div>
                    <div class="flex justify-between text-responsive-sm" x-show="discount > 0">
                        <span class="text-gray-500">Giảm giá:</span>
                        <span class="text-red-600" x-text="'-' + formatPrice(discount)">-151.000đ</span>
                    </div>
                    <div class="border-t border-gray-200 pt-3 lg:pt-4">
                        <div class="flex justify-between font-semibold">
                            <span class="text-responsive-lg">Tổng cộng:</span>
                            <span class="text-green-600 text-responsive-lg"
                                x-text="formatPrice(total)">1.397.000đ</span>
                        </div>
                    </div>
                </div>
                <button
                    @click="products.length > 0 ? window.location.href = './checkout.html' : showNotification('Giỏ hàng trống! Vui lòng thêm sản phẩm để thanh toán.', 'warning')"
                    class="w-full btn btn-primary btn-md"
                    :class="{ 'opacity-50 cursor-not-allowed': products.length === 0 }">
                    <i data-lucide="credit-card" class="w-4 h-4 lg:w-5 lg:h-5 mr-2"></i>
                    Thanh toán
                </button>
                <!-- Trust Badges -->
                <div class="grid grid-cols-3 gap-2 lg:gap-4 mt-4 lg:mt-6 pt-4 lg:pt-6 border-t border-gray-200">
                    <div class="text-center">
                        <div
                            class="w-8 h-8 lg:w-10 lg:h-10 bg-green-100 text-green-600 rounded-lg lg:rounded-xl flex items-center justify-center mx-auto mb-1 lg:mb-2">
                            <i data-lucide="shield" class="w-4 h-4 lg:w-5 lg:h-5"></i>
                        </div>
                        <div class="text-responsive-xs text-gray-500">Bảo mật</div>
                    </div>
                    <div class="text-center">
                        <div
                            class="w-8 h-8 lg:w-10 lg:h-10 bg-blue-100 text-blue-600 rounded-lg lg:rounded-xl flex items-center justify-center mx-auto mb-1 lg:mb-2">
                            <i data-lucide="truck" class="w-4 h-4 lg:w-5 lg:h-5"></i>
                        </div>
                        <div class="text-responsive-xs text-gray-500">Giao nhanh</div>
                    </div>
                    <div class="text-center">
                        <div
                            class="w-8 h-8 lg:w-10 lg:h-10 bg-purple-100 text-purple-600 rounded-lg lg:rounded-xl flex items-center justify-center mx-auto mb-1 lg:mb-2">
                            <i data-lucide="award" class="w-4 h-4 lg:w-5 lg:h-5"></i>
                        </div>
                        <div class="text-responsive-xs text-gray-500">Chất lượng</div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>